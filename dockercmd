#!/bin/bash -ex

./manage.py initialize
# exec ./manage.py runserver 0.0.0.0:8000

# poor man's cron
(
  while true; do
    ./manage.py clearsessions
    ./manage.py cleartokens
    sleep 444
  done
) &

if [[ "$DEBUG" == "true" ]]; then
	# TODO use hupper -m 
	exec gunicorn \
 	 --threads 10 \
 	 -b 0.0.0.0:8000 \
 	 liquidcore.site.wsgi:application
else
	exec gunicorn \
 	 --threads 10 \
 	 -b 0.0.0.0:8000 \
 	 liquidcore.site.wsgi:application
fi
